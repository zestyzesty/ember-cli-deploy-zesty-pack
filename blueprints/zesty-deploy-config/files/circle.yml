machine:
  node:
    version: 6.10.0

dependencies:
  override:
    - npm install -g bower yarn@rc
    - bower --version
    - bower install
    - /opt/circleci/nodejs/v6.10.0/bin/yarn --version
    - /opt/circleci/nodejs/v6.10.0/bin/yarn install --frozen-lockfile

  cache_directories:
    - /opt/circleci/nodejs/v6.10.0/bin
    - /opt/circleci/nodejs/v6.10.0/lib/node_modules

deployment:
  production:
    branch: master
    commands:
      - yarn run -- ember deploy production --activate

  pull-request:
    branch: /^((?!master).)*$/
    commands:
      - 'if [ -n "$CI_PULL_REQUEST" ]; then yarn run -- ember deploy pull-request; fi'
