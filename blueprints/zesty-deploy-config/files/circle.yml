machine:
  node:
    version: 6.10.0

dependencies:
  override:
    - npm install -g bower yarn
    - bower install
    - yarn install

  cache_directories:
    - /opt/circleci/nodejs/v6.10.0/bin
    - /opt/circleci/nodejs/v6.10.0/lib/node_modules

deployment:
  production:
    branch: master
    commands:
      - yarn run -- ember deploy production --activate

  pull-request:
    branch: /^((?!master).)*$/
    commands:
      - 'if [ -n "$CI_PULL_REQUEST" ]; then yarn run -- ember deploy pull-request; fi'
